<%@ page import="java.time.format.DateTimeFormatter" %><%@ page import="java.time.LocalDateTime" %><%@ page import="java.util.Date" %><%@ page import="models.Annonce" %><%@ page import="java.time.temporal.ChronoUnit" %><%@ page import="java.util.concurrent.TimeUnit" %><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %><%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %><%@ page contentType="text/html;charset=UTF-8" language="java" %><html lang="fr"><head>    <%-- modal style--%>    <style>        .modal-confirm {            color: #636363;            width: 325px;            margin: 30px auto;        }        .modal-confirm .modal-content {            padding: 20px;            border-radius: 5px;            border: none;        }        .modal-confirm .modal-header {            border-bottom: none;            position: relative;        }        .modal-confirm h4 {            text-align: center;            font-size: 26px;            margin: 30px 0 -15px;        }        .modal-confirm .form-control, .modal-confirm .btn {            min-height: 40px;            border-radius: 3px;        }        .modal-confirm .close {            position: absolute;            top: -5px;            right: -5px;        }        .modal-confirm .modal-footer {            border: none;            text-align: center;            border-radius: 5px;            font-size: 13px;        }        .modal-confirm .icon-box {            color: #fff;            position: absolute;            margin: 0 auto;            left: 0;            right: 0;            top: -70px;            width: 95px;            height: 95px;            border-radius: 50%;            z-index: 9;            background: #82ce34;            padding: 15px;            text-align: center;            box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1);        }        .modal-confirm .icon-box i {            font-size: 58px;            position: relative;            top: 3px;        }        .modal-confirm.modal-dialog {            margin-top: 80px;        }        .modal-confirm .btn {            color: #fff;            border-radius: 4px;            background: #82ce34;            text-decoration: none;            transition: all 0.4s;            line-height: normal;            border: none;        }        .modal-confirm .btn:hover, .modal-confirm .btn:focus {            background: #6fb32b;            outline: none;        }    </style>    <%-- modal style--%>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta http-equiv="X-UA-Compatible" content="ie=edge">    <title>Direo Template</title>    <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,600,700" rel="stylesheet">    <!-- inject:css-->    <link rel="stylesheet" href="css/bootstrap.css">    <link rel="stylesheet" href="vendor_assets/css/brands.css">    <link rel="stylesheet" href="vendor_assets/css/fontawesome.min.css">    <link rel="stylesheet" href="vendor_assets/css/jquery-ui.css">    <link rel="stylesheet" href="vendor_assets/css/jquery.mCustomScrollbar.css">    <link rel="stylesheet" href="vendor_assets/css/line-awesome.min.css">    <link rel="stylesheet" href="vendor_assets/css/magnific-popup.css">    <link rel="stylesheet" href="vendor_assets/css/owl.carousel.min.css">    <link rel="stylesheet" href="vendor_assets/css/select2.min.css">    <link rel="stylesheet" href="vendor_assets/css/slick.css">    <link rel="stylesheet" href="css/style.css">    <%-- modal links --%>    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">    <%-- modal links --%>    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"          integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="          crossorigin=""/>    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/opencagedata/leaflet-opencage-geocoding@v2.0.0/dist/css/L.Control.OpenCageGeocoding.min.css" />    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />    <!-- endinject -->    <link rel="icon" type="image/png" sizes="32x32" href="images/fevicon.png"></head><body>    <section class="listing-details-wrapper bgimage">        <%@ include file="header.jsp" %>        <div class="listing-info content_above">                <div class="container">                    <div class="row">                        <div class="col-lg-8 col-md-7">                            <ul class="list-unstyled listing-info--badges">                                <li><span class="atbd_badge atbd_badge_featured">Featured</span></li>                            </ul>                            <ul class="list-unstyled listing-info--meta">                                <li>                                    <div class="average-ratings">                                        <span class="atbd_meta atbd_listing_rating">${poster_rating_avg}<i class="la la-star"></i></span>                                        <span><strong>${poster_rating_count}</strong> Reviews</span>                                    </div>                                </li>                                <li>                                    <div class="atbd_listing_category">                                        <a><span class="la la-tree"></span></a>                                    </div>                                </li>                            </ul><!-- ends: .listing-info-meta -->                            <h1>${annonce.title}</h1>                            <p class="subtitle">${fn:substring(annonce.description, 0, 50)}...</p>                        </div>                        <div class="col-lg-4 col-md-5 d-flex align-items-end justify-content-start justify-content-md-end">                            <div class="atbd_listing_action_area">                                <div class="atbd_action atbd_save">                                    <div class="action_button">                                        <button id="addToFavorites" data-client="${sessionScope.currentUser.id}" data-annonce="${annonce.id}" class="atbdp-favourites">                                            <span class="la la-heart-o"></span> &#160;Save                                        </button>                                    </div>                                </div>                            </div><!-- ends: .atbd_listing_action_area -->                        </div>                    </div>                </div>                <div class="modal fade" id="atbdp-report-abuse-modal" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="atbdp-report-abuse-modal-label">                    <div class="modal-dialog modal-dialog-centered" role="document">                        <div class="modal-content">                            <form action="/" id="atbdp-report-abuse-form" class="form-vertical">                                <div class="modal-header">                                    <h3 class="modal-title" id="atbdp-report-abuse-modal-label">Report Abuse</h3>                                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span></button>                                </div>                                <div class="modal-body">                                    <div class="form-group">                                        <label for="atbdp-report-abuse-message" class="not_empty">Your Complaint<span class="atbdp-star">*</span></label>                                        <textarea class="form-control" id="atbdp-report-abuse-message" rows="4" placeholder="Message..." required=""></textarea>                                    </div>                                </div>                                <div class="modal-footer">                                    <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Close</button>                                    <button type="submit" class="btn btn-secondary btn-sm">Submit</button>                                </div>                            </form>                        </div>                    </div>                </div>                <div class="modal fade" id="moda_claim_listing" tabindex="-1" role="dialog" aria-labelledby="claim_listing_label" aria-hidden="true">                    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">                        <div class="modal-content">                            <div class="modal-header">                                <h5 class="modal-title" id="claim_listing_label"><i class="la la-check-square"></i> Claim This Listing</h5>                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                                    <span aria-hidden="true">&times;</span>                                </button>                            </div>                            <div class="modal-body">                                <form action="/">                                    <div class="form-group">                                        <div class="row">                                            <div class="col-md-6">                                                <input type="text" placeholder="Your Name" class="form-control" required>                                            </div>                                            <div class="col-md-6">                                                <input type="email" class="form-control" placeholder="Email Address" required>                                            </div>                                        </div>                                    </div>                                    <div class="form-group">                                        <div class="row">                                            <div class="col-md-6">                                                <input type="text" class="form-control" placeholder="Phone Number" required>                                            </div>                                            <div class="col-md-6">                                                <input type="url" class="form-control" placeholder="Listing URL" required>                                            </div>                                        </div>                                    </div>                                    <div class="form-group">                                        <div class="row">                                            <div class="col-lg-12">                                                <textarea class="form-control" rows="6" placeholder="Provie Listing Information" required></textarea>                                                <button type="submit" class="btn btn-secondary">Submit Query</button>                                            </div>                                        </div>                                    </div>                                </form>                            </div>                        </div>                    </div>                </div>            </div><!-- ends: .listing-info -->    </section><!-- ends: .card-details-wrapper -->    <section class="directory_listiing_detail_area single_area section-bg section-padding-strict">        <div class="container">            <div class="row">                <div class="col-lg-8">                    <div class="atbd_content_module atbd_listing_details">                        <div class="atbd_content_module__tittle_area">                            <div class="atbd_area_title">                                <h4><span class="la la-file-text-o"></span>Listing Details</h4>                            </div>                        </div>                        <div class="atbdb_content_module_contents">                            <p>${requestScope.annonce.getDescription()}</p>                        </div>                    </div><!-- ends: .atbd_content_module -->                    <div class="atbd_content_module atbd_listing_gallery">                        <div class="atbd_content_module__tittle_area">                            <div class="atbd_area_title">                                <h4><span class="la la-image"></span>Gallery</h4>                            </div>                        </div>                        <div class="atbdb_content_module_contents">                            <div class="gallery-wrapper">                                <div class="gallery-images">                                    <div class="single-image">                                        <img style="width: 100%" id="thumbnail" src="images/annonces_thumbnails/${annonce.getThumbnail()}" alt="">                                    </div>                                    <c:set var="gallerieString" value="${annonce.getGallerie()}" />                                    <c:set var="gallerieArray" value="${fn:split(gallerieString, ',')}"/>                                    <c:forEach var="imgDeGallerie" items="${gallerieArray}">                                        <div class="single-image">                                            <img style="width: 100%" src="images/annonces_galleries/<c:out value="${imgDeGallerie}" />" alt="">                                        </div>                                    </c:forEach>                                </div><!-- ends: .gallery-images -->                                <div class="gallery-thumbs">                                    <div class="single-thumb">                                        <img src="images/annonces_thumbnails/${annonce.getThumbnail()}" alt="">                                    </div>                                    <c:forEach var="imgDeGallerie" items="${gallerieArray}">                                        <div class="single-thumb">                                            <img style="width: 100%" src="images/annonces_galleries/<c:out value="${imgDeGallerie}" />" alt="">                                        </div>                                    </c:forEach>                                </div><!-- ends: .gallery-thumbs -->                            </div><!-- ends: .gallery-wrapper -->                        </div>                    </div><!-- ends: .atbd_content_module -->                    <div class="atbd_content_module atbd_custom_fields_contents">                        <div class="atbd_content_module__tittle_area">                            <div class="atbd_area_title">                                <h4><span class="la la-youtube-play"></span>Video</h4>                            </div>                        </div>                        <div class="atbdb_content_module_contents">                            <div class="video-wrapper">                                <figure>                                    <c:set var="videoUrlArray" value="${fn:split(annonce.getVideo_url(), 'v=')}" />                                    <c:set var="videoId" value="${videoUrlArray[1]}" />                                    <img src="http://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="">                                    <figcaption>                                        <a href="${annonce.getVideo_url()}" class="video-iframe play-btn">                                            <span class="la la-youtube-play"></span>                                        </a>                                    </figcaption>                                </figure>                            </div>                        </div>                    </div><!-- ends: .atbd_content_module -->                    <div class="atbd_content_module atbd_listing_features">                        <div class="atbd_content_module__tittle_area">                            <div class="atbd_area_title">                                <h4><span class="la la-map-o"></span>Location</h4>                            </div>                        </div>                        <div class="atbdb_content_module_contents">                            <ul class="atbd_custom_fields features-table">                                <!--  get data from custom field-->                                <li>                                    <div class="atbd_custom_field_title">                                        <p>Région :</p>                                    </div>                                    <div class="atbd_custom_field_content">                                        <p>${annonce.getTerrain().getRegion()}</p>                                    </div>                                </li>                                <li>                                    <div class="atbd_custom_field_title">                                        <p>Ville :</p>                                    </div>                                    <div class="atbd_custom_field_content">                                        <p>${annonce.getTerrain().getVille()}</p>                                    </div>                                </li>                                <li>                                    <div class="atbd_custom_field_title">                                        <p>Adresse :</p>                                    </div>                                    <div class="atbd_custom_field_content">                                        <p>${annonce.getTerrain().getAdresse()}</p>                                    </div>                                </li>                            </ul>                        </div>                        <div class="atbdb_content_module_contents">                            <div id="map" style="height: 200px"></div>                        </div>                    </div><!-- ends: .atbd_content_module -->                </div>                <div class="col-lg-4 mt-5 mt-lg-0">                    <div class="widget atbd_widget widget-card">                        <div class="atbd_widget_title">                            <h4><span class="la la-user"></span>Seller Info</h4>                        </div><!-- ends: .atbd_widget_title -->                        <div class="widget-body atbd_author_info_widget">                            <div class="atbd_avatar_wrapper">                                <div class="atbd_review_avatar">                                    <img src="images/avatar-60x60.jpg" alt="Avatar Image">                                </div>                                <div class="atbd_name_time">                                    <h4>${requestScope.annonce.getPossesseur().getNom()} ${requestScope.annonce.getPossesseur().getPrenom()}<span class="verified" data-toggle="tooltip" data-placement="top" title="Verified"></span></h4>                                    <%!                                        public static long getDifferenceDays(Date d1, Date d2) {                                            long diff = d2.getTime() - d1.getTime();                                            return TimeUnit.DAYS.convert(diff, TimeUnit.MILLISECONDS);                                        }                                    %>                                    <%                                        Annonce annonce = (Annonce) request.getAttribute("annonce");                                        long days = getDifferenceDays(new Date(), annonce.getDateDePub());                                        request.setAttribute("days",-days);                                    %>                                    <span class="review_time">Posted ${requestScope.days} days ago</span>                                </div>                            </div><!-- ends: .atbd_avatar_wrapper -->                            <div class="atbd_widget_contact_info">                                <ul>                                    <li>                                        <span class="la la-phone"></span>                                        <span class="atbd_info">${requestScope.annonce.getTelephone_number()}</span>                                    </li>                                    <li>                                        <span class="la la-envelope"></span>                                        <span class="atbd_info">${requestScope.annonce.getEmail()}</span>                                    </li>                                </ul>                            </div><!-- ends: .atbd_widget_contact_info -->                            <div class="atbd_social_wrap">                                <p><a href=""><span class="fab fa-facebook-f"></span></a></p>                                <p><a href=""><span class="fab fa-twitter"></span></a></p>                                <p><a href=""><span class="fab fa-google-plus-g"></span></a></p>                                <p><a href=""><span class="fab fa-linkedin-in"></span></a></p>                                <p><a href=""><span class="fab fa-dribbble"></span></a></p>                            </div><!-- ends: .atbd_social_wrap -->                            <a href="" class="btn btn-outline-primary btn-block">View Profile</a>                        </div><!-- ends: .widget-body -->                    </div><!-- ends: .widget -->                    <div class="widget atbd_widget widget-card">                        <div class="atbd_widget_title">                            <h4><span class="la la-tags"></span> Tags</h4>                        </div>                        <div class="widget-body atbdp-widget-tags">                            <ul class="list-unstyled">                                <c:set var="tagsString" value="${requestScope.annonce.getTags()}" />                                <c:set var="tagsArray" value="${fn:split(tagsString, ',')}"/>                                <c:forEach var="t" items="${tagsArray}">                                    <li><a href=""><c:out value="${t}" /></a></li>                                </c:forEach>                            </ul>                        </div><!-- ends: .widget-body -->                    </div><!-- ends: .widget -->                    <div class="widget atbd_widget widget-card">                        <div class="atbd_widget_title">                            <h4><span class="la la-envelope"></span> Sidebar Form</h4>                        </div><!-- ends: .atbd_widget_title -->                        <div class="atbdp-widget-listing-contact">                            <form id="atbdp-contact-form" class="form-vertical msg-form" role="form" method="post" action="../new-message-traitement" enctype="multipart/form-data">                                <input hidden type="text" name="annonceId" id="annonceId" value="${annonce.getId()}">                                <p>${annonce.getId()}</p>                                <input hidden type="text" name="receiverId" id="receiverId" value="${annonce.getPossesseur().getId()}">                                <p>${annonce.getPossesseur().getId()}</p>                                <div class="form-group">                                    <textarea type="text" class="form-control" id="atbdp-contact-message" rows="6" placeholder="Message" name="text" required=""></textarea>                                </div>                                <button type="submit" class="btn btn-outline-secondary btn-block">Contact Poster</button>                            </form>                        </div><!-- ends: .atbdp-widget-listing-contact -->                    </div><!-- ends: .widget -->                </div>            </div>        </div>    </section><!-- ends: .directory_listiing_detail_area -->    <%@ include file="footer.jsp"%>    <!-- Modal HTML -->    <div id="myModal" class="modal fade">        <div class="modal-dialog modal-confirm">            <div class="modal-content">                <div class="modal-header">                    <div class="icon-box">                        <i class="material-icons">&#xE876;</i>                    </div>                    <h4 class="modal-title">Awesome!</h4>                </div>                <div class="modal-body">                    <p class="text-center">Votre message a été bien envoyé.</p>                </div>                <div class="modal-footer">                    <button id="modalOK" class="btn btn-success btn-block" data-dismiss="modal">OK</button>                </div>            </div>        </div>    </div>    <div id="myModalFav" class="modal fade">        <div class="modal-dialog modal-confirm">            <div class="modal-content">                <div class="modal-header">                    <div class="icon-box">                        <i class="material-icons">&#xE876;</i>                    </div>                    <h4 class="modal-title">Awesome!</h4>                </div>                <div class="modal-body">                    <p class="text-center">Cette annonce a été bien enregistré dans vos favoris.</p>                </div>                <div class="modal-footer">                    <button id="modalOKFav" class="btn btn-success btn-block" data-dismiss="modal">OK</button>                </div>            </div>        </div>    </div>    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0C5etf1GVmL_ldVAichWwFFVcDfa1y_c"></script>    <!-- inject:js-->    <script src="vendor_assets/js/jquery/jquery-1.12.3.js"></script>    <script src="vendor_assets/js/bootstrap/popper.js"></script>    <script src="vendor_assets/js/bootstrap/bootstrap.min.js"></script>    <script src="vendor_assets/js/jquery-ui.min.js"></script>    <script src="vendor_assets/js/jquery.barrating.min.js"></script>    <script src="vendor_assets/js/jquery.counterup.min.js"></script>    <script src="vendor_assets/js/jquery.magnific-popup.min.js"></script>    <script src="vendor_assets/js/jquery.mCustomScrollbar.concat.min.js"></script>    <script src="vendor_assets/js/jquery.waypoints.min.js"></script>    <script src="vendor_assets/js/masonry.pkgd.min.js"></script>    <script src="vendor_assets/js/owl.carousel.min.js"></script>    <script src="vendor_assets/js/select2.full.min.js"></script>    <script src="vendor_assets/js/slick.min.js"></script>    <script src="theme_assets/js/locator.js"></script>    <script src="theme_assets/js/main.js"></script>    <script src="theme_assets/js/map.js"></script>    <script src="js/new-message.js" ></script>    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"            integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="            crossorigin="">    </script>    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>    <script>        var marker;        var mymap = L.map('map').setView([${annonce.getTerrain().getLatitude()}, ${annonce.getTerrain().getLongitude()}], 13);        L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {            // Il est toujours bien de laisser le lien vers la source des données            attribution: 'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',            minZoom: 1,            maxZoom: 20        }).addTo(mymap);        var iconeClient = L.icon({            iconUrl: "images/location.png",            iconSize: [50, 50],            iconAnchor: [25, 50],                //icone pour le client            popupAnchor: [0, -50]        });        marker = L.marker([${annonce.getTerrain().getLatitude()},${annonce.getTerrain().getLongitude()}],{icon: iconeClient}).bindPopup("<b>terrain sélectionné</b>");        marker.addTo(mymap);        L.Control.geocoder().addTo(mymap);    </script>    <!-- endinject--></body></html><%--    <style>--%><%--        #thumbnail::after {--%><%--            content: '';--%><%--            position: absolute;--%><%--            top: 0; right: 0;--%><%--            bottom: 0; left: 0;--%><%--            background: url("images/annonces_thumbnails/${annonce.getThumbnail()}") repeat;--%><%--        }--%><%--    </style>--%>